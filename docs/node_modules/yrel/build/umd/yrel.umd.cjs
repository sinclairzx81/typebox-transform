(function(_,d){typeof exports=="object"&&typeof module<"u"?d(exports):typeof define=="function"&&define.amd?define(["exports"],d):(_=typeof globalThis<"u"?globalThis:_||self,d(_.yrel={}))})(this,function(_){"use strict";const d=Symbol("YREL"),B=Symbol("YREL_OPTIONAL"),U=Symbol("YREL_NULLABLE"),L=Symbol("YREL_ANY"),b=Symbol("YREL_BOOLEAN"),R=Symbol("YREL_NUMBER"),E=Symbol("YREL_STRING"),S=Symbol("YREL_LITERAL"),v=Symbol("YREL_ARRAY"),A=Symbol("YREL_UNION"),O=Symbol("YREL_TUPLE"),N=Symbol("YREL_OBJECT"),V=Symbol("YREL_RECORD"),m=(t,e,r)=>{const n=(r==null?void 0:r.key)??"",i=[];let o=e,s=!0,u=[];try{for(const c of t.__checkers)if(c(o,t.__cache))return{key:n,isValid:s,data:o,errors:i,children:u};for(const c of t.__cache.preprocessors??[])o=c(o,t.__cache);t.__cache.defaultData!==void 0&&o===void 0&&(o=t.__cache.defaultData);for(const c of t.__resolvers){const a=c(o,t.__cache,{key:n});o=a.data,a.errors&&i.push(...a.errors),a.children&&(u=a.children)}for(const c of t.__validators){const a=c(o,t.__cache);a!==!0&&i.push(...a)}if(!i.length)for(const c of t.__cache.transformers??[])o=c(o,t.__cache)}catch(c){console.error(c),i.push(["err_unknown"])}return s=i.length===0&&u.every(c=>c.isValid),{key:n,isValid:s,data:o,errors:i,children:u}},T=t=>t!==null&&typeof t=="object"&&typeof t!="function"&&!Array.isArray(t),f=t=>{const{name:e,resolver:r,properties:n,validators:i,narrowers:o}=t,s=t.schemaBase??{},{__cache:u,__checkers:c,__resolvers:a,__validators:h}=s;for(const l of Object.keys(s))delete s[l];if(s.__type=d,s.__name=e,s.__cache=u??{},s.__checkers=Array.isArray(c)?[...c]:[(l,y)=>!!y.isOptional&&l===void 0,(l,y)=>!!y.isNullable&&l===null],s.__resolvers=a??[],s.__resolvers.push(r),s.__validators=Array.isArray(h)?[...h]:[],n&&Object.assign(s,n),s.preprocess=l=>(s.__cache.preprocessors=s.__cache.preprocessors?[...s.__cache.preprocessors,l]:[l],s),s.defaultsTo=l=>(s.__cache.defaultData=l,s),s.transform=l=>(s.__cache.transformers=s.__cache.transformers?[...s.__cache.transformers,l]:[l],s),s.validate=l=>(s.__validators.push(y=>l(y,s.__cache)),s),i)for(const l of Object.keys(i)){const y=l,p=i[y];Object.assign(s,{[y]:(...k)=>{const[g,...M]=[...k].reverse(),G=M.reverse(),I=g!==null&&typeof g=="object"&&"errors"in g&&Array.isArray(g.errors)&&g.errors.every(Y=>Array.isArray(Y)),J=I?G:k,q=(Y,F)=>{const w=p(...J)(Y,F);return w===!0?!0:I&&g.errors||w};return s.__validators.push(q),s}})}if(Object.assign(s,{coerce:()=>(s.__cache.coerce=!0,s),optional:()=>(s.__cache.isOptional=!0,s),nullable:()=>(s.__cache.isNullable=!0,s)}),o)for(const l of Object.keys(o)){const y=l,p=o[y];Object.assign(s,{[y]:(...k)=>p(s)(...k)})}return s},j={any:()=>f({schemaBase:null,name:L,resolver:(t,e,r)=>({key:r.key,isValid:!0,data:t,errors:[],children:[]})}),boolean:t=>f({schemaBase:t,name:b,resolver:(e,r,n)=>{const i=r.coerce?!!e:e;return typeof i=="boolean"?{key:n.key,isValid:!0,data:i,errors:[],children:[]}:{key:n.key,isValid:!1,data:i,errors:[["err_boolean"]],children:[]}},validators:{truthy:()=>e=>e===!0||[["err_boolean_truthy"]]}}),number:t=>f({schemaBase:t,name:R,resolver:(e,r,n)=>{const i=r.coerce?Number(e):e;return typeof i=="number"&&!isNaN(i)&&Number.isFinite(i)?{key:n.key,isValid:!0,data:i,errors:[],children:[]}:{key:n.key,isValid:!1,data:i,errors:[["err_number"]],children:[]}},validators:{gt:e=>r=>typeof r!="number"?[]:r>e||[["err_number_gt",{gt:e}]],gte:e=>r=>typeof r!="number"?[]:r>=e||[["err_number_gte",{gte:e}]],lt:e=>r=>typeof r!="number"?[]:r<e||[["err_number_lt",{lt:e}]],lte:e=>r=>typeof r!="number"?[]:r<=e||[["err_number_lte",{lte:e}]],integer:()=>e=>typeof e!="number"?[]:Number.isInteger(e)&&Number.isSafeInteger(e)||[["err_number_integer"]]}}),string:t=>f({schemaBase:t,name:E,resolver:(e,r,n)=>{const i=r.coerce?e instanceof Date?e.toISOString():String(e):e;return typeof i=="string"?{key:n.key,isValid:!0,data:i,errors:[],children:[]}:{key:n.key,isValid:!1,data:i,errors:[["err_string"]],children:[]}},validators:{nonempty:()=>e=>typeof e!="string"?[]:e.length>0||[["err_string_nonempty"]],trim:()=>e=>typeof e!="string"?[]:e===e.trim()||[["err_string_trim"]],length:e=>r=>typeof r!="string"?[]:r.length===e||[["err_string_length",{length:e}]],min:e=>r=>typeof r!="string"?[]:r.length>=e||[["err_string_min",{min:e}]],max:e=>r=>typeof r!="string"?[]:r.length<=e||[["err_string_max",{max:e}]],datetime:()=>e=>{if(typeof e!="string")return[];const r=Date.parse(e),n=isNaN(r)?null:new Date(r).toISOString().slice(0,19),i=e.slice(0,19),o=/^(\.\d{1,3})?Z$/.test(e.slice(19));return n===i&&o||[["err_string_date_time"]]},date:()=>e=>{if(typeof e!="string")return[];const r=Date.parse(e);return(isNaN(r)?null:new Date(r).toISOString().slice(0,10))===e||[["err_string_date"]]},time:()=>e=>{if(typeof e!="string")return[];const r=Date.parse(`2000-01-01T${e}Z`),n=isNaN(r)?null:new Date(r).toISOString().slice(11,19),i=e.slice(0,8),o=/^(\.\d{1,3})?$/.test(e.slice(8));return n===i&&o||[["err_string_time"]]},lowercase:()=>e=>typeof e!="string"?[]:e===e.toLowerCase()||[["err_string_lowercase"]],uppercase:()=>e=>typeof e!="string"?[]:e===e.toUpperCase()||[["err_string_uppercase"]],capitalcase:e=>r=>{if(typeof r!="string")return[];const n=e!=null&&e.lower?r.toLowerCase():r;return r===n.replace(/(?:^|\s|["'([{])+\S/g,i=>i.toUpperCase())||[["err_string_capitalcase",{lower:!!(e!=null&&e.lower)}]]}}}),literal:(t,e)=>f({schemaBase:e,name:S,resolver:(r,n,i)=>Object.is(r,t)?{key:i.key,isValid:!0,data:r,errors:[],children:[]}:{key:i.key,isValid:!1,data:r,errors:[["err_literal",{literal:t}]],children:[]}}),array:(t,e)=>f({schemaBase:e,name:v,resolver:(r,n,i)=>{if(!Array.isArray(r))return{key:i.key,isValid:!1,data:r,errors:[["err_array"]],children:[]};const o=r.map((u,c)=>{const a=i.key?`${i.key}.${c}`:String(c);return m(t,u,{key:a})}),s=o.every(u=>u.isValid);return{key:i.key,isValid:s,data:r,errors:[],children:o}},validators:{nonempty:()=>r=>Array.isArray(r)?r.length>0||[["err_array_nonempty"]]:[],length:r=>n=>Array.isArray(n)?n.length===r||[["err_array_length",{length:r}]]:[],min:r=>n=>Array.isArray(n)?n.length>=r||[["err_array_min",{min:r}]]:[],max:r=>n=>Array.isArray(n)?n.length<=r||[["err_array_max",{max:r}]]:[]}}),union:(t,e,r)=>{if(!t||!t.length)throw new Error("Data validator .union([...schemas]) requires schema definitions.");return f({schemaBase:r,name:A,resolver:(n,i,o)=>{for(const s of t)if(m(s,n,o).isValid)return{key:o.key,isValid:!0,data:n,errors:[],children:[]};return e!=null&&e.errors?{key:o.key,isValid:!1,data:n,errors:e.errors,children:[]}:{key:o.key,isValid:!1,data:n,errors:[["err_union"]],children:[]}}})},tuple:(t,e,r)=>{if(!t||!t.length)throw new Error("Data validator .tuple([...schemas]) requires at least one schema definition.");return f({schemaBase:r,name:O,resolver:(n,i,o)=>{if(!Array.isArray(n)||!e&&n.length!==t.length)return{key:o.key,isValid:!1,data:n,errors:[["err_tuple"]],children:[]};const s=t.map((h,l)=>{const y=o.key?`${o.key}.${l}`:String(l);return m(h,n[l],{key:y})});let u=[];e&&(u=n.slice(t.length).map((l,y)=>{const p=t.length+y,k=o.key?`${o.key}.${p}`:String(p);return m(e,l,{key:k})}));const c=[...s,...u],a=c.every(h=>h.isValid);return{key:o.key,isValid:a,data:n,errors:[],children:c}}})},object:(t,e)=>f({schemaBase:e,name:N,resolver:(r,n,i)=>{if(!T(r))return{key:i.key,isValid:!1,data:r,errors:[["err_object"]],children:[]};const o=Object.keys(t),s=Object.keys(r);if(!n.passthroughObjectProps){const a=s.filter(h=>!Object.prototype.hasOwnProperty.call(t,h));if(a.length>0)return{key:i.key,isValid:!1,data:r,errors:[["err_object_unexpected_props",{props:a}]],children:[]}}const u=o.map(a=>{const h=t[a],l=r[a],y=i.key?`${i.key}.${String(a)}`:String(a);return m(h,l,{key:y})}),c=u.every(a=>a.isValid);return{key:i.key,isValid:c,data:r,errors:[],children:u}},properties:{shape:t},narrowers:{passthrough:r=>()=>(r.__cache.passthroughObjectProps=!0,r)}}),record:(t,e,r)=>f({schemaBase:r,name:V,resolver:(n,i,o)=>{if(!T(n))return{key:o.key,isValid:!1,data:n,errors:[["err_record"]],children:[]};const s=n,u=Object.keys(s),c=u.filter(y=>!m(t,y).isValid),a=u.map(y=>{const p=s[y],k=o.key?`${o.key}.${String(y)}`:String(y);return m(e,p,{key:k})}),h=!c.length&&a.every(y=>y.isValid),l=c.length?[["err_record_keys",{keys:c}]]:[];return{key:o.key,isValid:h,data:n,errors:l,children:a}}})},P=j,$=t=>t!==null&&typeof t=="object"&&t.__type===d,D=t=>[...t.errors.length>0?[{key:t.key,errors:t.errors}]:[],...t.children.reduce((e,r)=>[...e,...D(r)],[])],C=(t,e,r)=>{const{rootKey:n=""}={...r},i=m(t,e,{key:n}),o=i.isValid;return o?{isValid:o,issues:[],data:i.data}:{isValid:o,issues:D(i),data:void 0}};_.YREL=d,_.YREL_ANY=L,_.YREL_ARRAY=v,_.YREL_BOOLEAN=b,_.YREL_LITERAL=S,_.YREL_NULLABLE=U,_.YREL_NUMBER=R,_.YREL_OBJECT=N,_.YREL_OPTIONAL=B,_.YREL_RECORD=V,_.YREL_STRING=E,_.YREL_TUPLE=O,_.YREL_UNION=A,_.isYrel=$,_.processYrel=m,_.validateYrel=C,_.y=P,_.yrel=j,Object.defineProperty(_,Symbol.toStringTag,{value:"Module"})});
